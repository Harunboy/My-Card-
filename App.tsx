
import React, { useState, useEffect } from 'react';
import BusinessCard from './components/BusinessCard';
import type { BusinessCardData } from './types';

const App: React.FC = () => {
  const [cardData, setCardData] = useState<BusinessCardData>(() => {
    const savedProfileImage = localStorage.getItem('profileImageUrl');
    const savedCardFrontImage = localStorage.getItem('cardFrontImageUrl');
    const savedCardBackImage = localStorage.getItem('cardBackImageUrl');
    
    const defaultProfileImage = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAkAAAAJACAYAAABl29sOAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAAsTAAALEwEAmpwYAAAF6UlEQVR42u3dTU7bQBiA0b//0r1gB2knyU0y2sRJG4kHiJ3E8ggpJDgFx85M/n3A88f58uWrf75+AfA0IBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBAIBEIBA-AECBAAEC8gDLz0AAAAAElFTkSuQmCC";
    const phone = "+255 672 426 026";
    const email = "michaelmgani100@gmail.com";
    const vCardPhone = phone.replace(/\s/g, ''); // Remove spaces for vCard
    const cardUrl = window.location.href;

    const vCardData = `BEGIN:VCARD
VERSION:3.0
FN:M ART PRO
ORG:SANAA BORA TABASAMU BORA
TITLE:Mkurugenzi Mtendaji
TEL;TYPE=WORK,VOICE:${vCardPhone}
EMAIL:${email}
URL:${cardUrl}
END:VCARD`;

    return {
      name: "M ART PRO",
      title: "Mkurugenzi Mtendaji",
      company: "SANAA BORA TABASAMU BORA",
      profileImageUrl: savedProfileImage || defaultProfileImage,
      email: email,
      phone: phone,
      address: "123 Mtaa wa Tech, Dar es Salaam, Tanzania",
      socials: {
        facebook: "https://www.facebook.com/profile.php?id=61557616404688",
        instagram: "https://www.instagram.com/artboy2552?igsh=bnByZ282d2xrMDdl",
        tiktok: "https://www.tiktok.com/@m_art_pro?_r=1&_t=ZM-92i1995dmBM",
        whatsapp: `https://wa.me/255672426026`,
      },
      vCardUrl: `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(vCardData)}`,
      vCardRawData: vCardData,
      cardFrontImageUrl: savedCardFrontImage || undefined,
      cardBackImageUrl: savedCardBackImage || undefined,
    };
  });

  const [adminPassword, setAdminPassword] = useState('MICHAEL');

  useEffect(() => {
    const storedPassword = localStorage.getItem('adminPassword');
    if (storedPassword) {
      setAdminPassword(storedPassword);
    } else {
      localStorage.setItem('adminPassword', 'MICHAEL');
    }
  }, []);

  const handleUpdateCard = (newData: Partial<BusinessCardData>) => {
    if (newData.profileImageUrl) {
      localStorage.setItem('profileImageUrl', newData.profileImageUrl);
    }
    if (newData.cardFrontImageUrl) {
      localStorage.setItem('cardFrontImageUrl', newData.cardFrontImageUrl);
    }
    if (newData.cardBackImageUrl) {
      localStorage.setItem('cardBackImageUrl', newData.cardBackImageUrl);
    }
    setCardData(prevData => ({ ...prevData, ...newData }));
  };

  const handlePasswordUpdate = (newPassword: string) => {
    localStorage.setItem('adminPassword', newPassword);
    setAdminPassword(newPassword);
  };

  return (
    <main className="bg-slate-100 dark:bg-slate-900 min-h-screen flex items-center justify-center p-4 font-sans">
      <BusinessCard 
        data={cardData} 
        onUpdate={handleUpdateCard} 
        adminPassword={adminPassword}
        onPasswordUpdate={handlePasswordUpdate}
      />
    </main>
  );
};

export default App;
